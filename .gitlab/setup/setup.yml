---
setup_agent_version:
  stage: setup
  image: 486234852809.dkr.ecr.us-east-1.amazonaws.com/ci/datadog-agent-buildimages/deb_x64$DATADOG_AGENT_BUILDIMAGES_SUFFIX:$DATADOG_AGENT_BUILDIMAGES
  tags: ["runner:main"]
  script:
    - inv -e agent.version --version-cached
    - $S3_CP_CMD $CI_PROJECT_DIR/agent-version.cache $S3_ARTIFACTS_URI/agent-version.cache

get_file_diff:
  image: 486234852809.dkr.ecr.us-east-1.amazonaws.com/ci/datadog-agent-buildimages/deb_x64$DATADOG_AGENT_BUILDIMAGES_SUFFIX:$DATADOG_AGENT_BUILDIMAGES
  tags: ["runner:main"]
  needs: []
  stage: setup
  script:
    - git fetch origin main:main
    - echo "DIFF_FILES=$(inv agent.generate-git-file-diff)" > file_diff.env
    - cat file_diff.env
  artifacts:
    reports:
      dotenv: file_diff.env


